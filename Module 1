Option Explicit

Sub Refresh()
   ThisWorkbook.Connections(1).Refresh
End Sub

Sub Create_BACKLOG_FOLDER()

    On Error GoTo leave
    MkDir "K:\Logistics\#NEW FOLDER STRUCTURE\4. MATERIAL PLANNING\1. MEMBERS\49_Csabi\HETI_BACKLOG_RIPORT\BACKLOG_XLS_MENTÉSEK\" & Date
    MsgBox "Folder is created.", vbInformation
    Exit Sub
leave:
    MsgBox "Folder already exists.", vbInformation
    
End Sub

Sub GenerateBacklogXLSFiles()

    With Application
        .ScreenUpdating = False
        .DisplayAlerts = False
        .Calculation = xlCalculationManual
    End With
    
    Dim NewBacklogWB As Workbook
    Dim NewBacklogWS As Worksheet
    Dim besz As Long
    Dim CURRENTWB As Workbook
    Dim CURRENTSHEET As Worksheet
    Dim TableArray As Variant
    Dim r As Long
    Dim c As Long
    Dim row As Long
    
    Let row = 2
    Let besz = Sheet2.Range("D1").Value
    Set NewBacklogWB = Workbooks.Add
    Set NewBacklogWS = NewBacklogWB.Sheets(1)
    Set CURRENTWB = ThisWorkbook
    Set CURRENTSHEET = CURRENTWB.Sheets("AX_OPEN_ORDERS_TXT")
    TableArray = CURRENTSHEET.ListObjects("AX_OPEN_ORDERS_TXT").Range
    
    NewBacklogWB.SaveAs ("K:\Logistics\#NEW FOLDER STRUCTURE\4. MATERIAL PLANNING\1. MEMBERS\49_Csabi\HETI_BACKLOG_RIPORT\BACKLOG_XLS_MENTÉSEK\" & Date & "\" & besz & ".xls")
    NewBacklogWS.Name = besz
    NewBacklogWS.Tab.Color = vbRed
    
    With NewBacklogWS
        CURRENTSHEET.ListObjects("AX_OPEN_ORDERS_TXT").HeaderRowRange.Copy Destination:=.Range("A1")
    
        For r = LBound(TableArray, 1) To UBound(TableArray, 1) Step 1
            If TableArray(r, 3) = besz And TableArray(r, 1) = "BACKLOG" Then
                For c = LBound(TableArray, 2) To UBound(TableArray, 2) Step 1
                        .Cells(row, c) = TableArray(r, c)
                Next c
                row = row + 1
            End If
        Next r
        
        .Range("N:S").Delete
        .UsedRange.EntireColumn.AutoFit
    
    End With
    
    Set NewBacklogWB = Nothing
    Set NewBacklogWS = Nothing
    Set CURRENTWB = Nothing
    Set CURRENTSHEET = Nothing
    
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    Application.Calculation = xlCalculationAutomatic
    
End Sub

Sub GenerateMassBacklogXLSFiles()

    Dim dict As Scripting.Dictionary
    Dim VendorArray As Variant
    Dim lastrow
    Dim r As Long
    
    Let lastrow = Sheet1.UsedRange.Rows.Count
    Let VendorArray = Sheet1.Range("D1", "D" & lastrow)
    Set dict = New Scripting.Dictionary
    
    For r = LBound(VendorArray) To UBound(VendorArray) Step 1
        dict.Add r, VendorArray(r, 1)
        Debug.Print dict(r)
    Next r
    
    
    
End Sub


